<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="robots" content="noindex,nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>使い方</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/cerulean/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/knockout@3.5.1/build/output/knockout-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha256-3gQJhtmj7YnV1fmtbVcnAV6eI4ws0Tr48bVZCThtCGQ=" crossorigin="anonymous"></script>
    <style type="text/css">img { max-width:100%; }</style>
  </head>
  <body data-bs-spy="scroll" data-bs-target="#nav-contents" data-bs-smooth-scroll="true">
    <div id="header" class="mb-2">
      <nav class="navbar navbar-expand-sm bg-body-tertiary shadow-sm">
        <div class="container-fluid">
          <a class="navbar-brand" href="/html/index.html"><i class="d-none d-sm-inline d-md-none bi bi-info-square"></i><span class="d-inline d-sm-none d-md-inline">PeerCastStation</span></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <li class="nav-item me-lg-2"><a class="nav-link" href="/html/channels.html"><i class="bi bi-book"></i> Yellow Page</a></li>
              <li class="nav-item me-lg-2"><a class="nav-link" href="/html/relays.html"><i class="bi bi-collection-play"></i> チャンネル</a></li>
              <li class="nav-item me-lg-2"><a class="nav-link" href="/html/settings.html"><i class="bi bi-gear"></i> 設定</a></li>
              <li class="nav-item me-lg-2"><a class="nav-link" href="/html/logs.html"><i class="bi bi-journal-text"></i> ログ</a></li>
              <li class="nav-item me-lg-2"><a class="nav-link active" href="/help/index.html"><i class="bi bi-question-square"></i> ヘルプ</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>

    <div id="nav-offcanvas" class="offcanvas offcanvas-start">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">目次</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
    <nav class="nav nav-pills flex-column">

      <h5 class="nav-header">PeerCastStationについて</h5>



      <a class="nav-link " href="/help/">PeerCastStationについて</a>



      <h5 class="nav-header">使い方</h5>



      <a class="nav-link active" data-bs-toggle="collapse" href="#nav-contents2" role="button" aria-expanded="true">使い方</a>
      <div id="nav-contents2" class="list-group collapse show">
        <a class='list-group-item list-group-item-action' href='#使い方'>使い方</a>
<a class='list-group-item list-group-item-action' href='#使い方---gui編'>使い方 - GUI編</a>
<a class='list-group-item list-group-item-action' href='#設定'>設定</a>
<a class='list-group-item list-group-item-action' href='#配信を見る'>配信を見る</a>
<a class='list-group-item list-group-item-action' href='#使い方---html-ui編'>使い方 - HTML UI編</a>
<a class='list-group-item list-group-item-action' href='#設定-1'>設定</a>
<a class='list-group-item list-group-item-action' href='#配信を見る-1'>配信を見る</a>
<a class='list-group-item list-group-item-action' href='#使い方---その他'>使い方 - その他</a>
<a class='list-group-item list-group-item-action' href='#自動リレー管理について'>自動リレー管理について</a>
      </div>




      <a class="nav-link " href="/help/ypbrowser.html">YPブラウザの使い方</a>



      <h5 class="nav-header">設定</h5>



      <a class="nav-link " href="/help/settings.html">設定</a>



      <h5 class="nav-header">配信</h5>



      <a class="nav-link " href="/help/broadcast.html">配信</a>



      <h5 class="nav-header">その他</h5>



      <a class="nav-link " href="/help/misc.html">その他</a>



    </nav>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="col-3 d-none d-sm-block">
          <nav class="nav nav-pills flex-column sticky-top">

            <h5 class="nav-header">PeerCastStationについて</h5>



            <a class="nav-link " href="/help/">PeerCastStationについて</a>



            <h5 class="nav-header">使い方</h5>



            <a class="nav-link active" data-bs-toggle="collapse" href="#nav-contents" role="button" aria-expanded="true">使い方</a>
            <div id="nav-contents" class="list-group collapse show">
              <a class='list-group-item list-group-item-action' href='#使い方'>使い方</a>
<a class='list-group-item list-group-item-action' href='#使い方---gui編'>使い方 - GUI編</a>
<a class='list-group-item list-group-item-action' href='#設定'>設定</a>
<a class='list-group-item list-group-item-action' href='#配信を見る'>配信を見る</a>
<a class='list-group-item list-group-item-action' href='#使い方---html-ui編'>使い方 - HTML UI編</a>
<a class='list-group-item list-group-item-action' href='#設定-1'>設定</a>
<a class='list-group-item list-group-item-action' href='#配信を見る-1'>配信を見る</a>
<a class='list-group-item list-group-item-action' href='#使い方---その他'>使い方 - その他</a>
<a class='list-group-item list-group-item-action' href='#自動リレー管理について'>自動リレー管理について</a>
            </div>




            <a class="nav-link " href="/help/ypbrowser.html">YPブラウザの使い方</a>



            <h5 class="nav-header">設定</h5>



            <a class="nav-link " href="/help/settings.html">設定</a>



            <h5 class="nav-header">配信</h5>



            <a class="nav-link " href="/help/broadcast.html">配信</a>



            <h5 class="nav-header">その他</h5>



            <a class="nav-link " href="/help/misc.html">その他</a>



          </nav>
        </div>
        <div class="col">
          <div class="row d-flex d-sm-none sticky-top">
            <button class="col-auto ms-auto btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#nav-offcanvas"><i class="bi bi-bookmarks"></i> 目次</button>
          </div>
          <h1 id="使い方">使い方</h1>

<h2 id="使い方---gui編">使い方 - GUI編</h2>
<p>起動すると次のような画面になります。</p>

<p><img src="images/gui_main.png" alt="起動イメージ" /></p>

<p>monoでは現在GUIは起動しません。HTML UIを使用してください。HTML UIの使い方は<a href="#html-ui">使い方 - HTML UI編</a>を見てください。</p>

<p>Windowsではウィンドウを閉じても終了しません。メニューからファイル(F)→終了(Q)を選択するか、タスクトレイにあるアイコンを右クリックして終了(Q)を実行してください。</p>

<p><img src="images/gui_statusmenu.png" alt="ステータスアイコン・メニュー" /></p>

<h3 id="設定">設定</h3>
<p>まずはメニューからツール(T)→設定(S)…メニューを選択して設定画面を出します。</p>

<p><img src="images/gui_settings.png" alt="設定画面" /></p>

<p>ポートは既定で7144が設定されています。基本的には変更する必要はありません。
ルータのポート開放は手動で行ってください。</p>

<p>開放確認ボタンを押すとポートが空けられているか確認できます。「開放されています」になった場合は問題ありません。「未開放です」になった場合は使っているマシンに向けてポートが開放されていません。設定の方法はルータの説明を見てください。</p>

<p>ポート番号を変更した場合は開放確認ボタンを押す前に右下の適用ボタンを押しておいてください。</p>

<p>あとは最大上り帯域を設定しましょう。
最大上り帯域の合計は自動設定ボタンを押すことで設定できます。しばらく時間がかかるので(長くて30秒程度)押したら気長に待ってください。
計測した上り帯域数の80%の値が自動的に設定されます。</p>

<p>最大上り帯域のチャンネル毎の方は制限無しのままで問題ありません。一つのチャンネルで帯域が埋まると困るなど判断できる場合に適度に設定してください。</p>

<p>チャンネル自動切断は終了したチャンネルなどを自動的にチャンネル一覧から消す(リレーも切る)機能です。既定では接続していない(視聴もリレーもしていない)状態が30分続くとチャンネルが消えるようになっています。使ってみて好きなように設定してください。</p>

<p>配信を見るだけならここまで設定すれば十分です。OKボタンを押して閉じてください。</p>

<h3 id="配信を見る">配信を見る</h3>
<p>新しく配信を見るのは、WebブラウザでYPのページからPlayリンクで再生するか、各種YPブラウザで再生を開始してください。
PeerCastStation内蔵のYPブラウザを使用するには<a href="ypbrowser.html">YPブラウザのヘルプ</a>を見てください。</p>

<p><img src="images/gui_main.png" alt="起動イメージ" /></p>

<p>接続しているチャンネルはチャンネル一覧に出ます。</p>

<p>チャンネルを選択して再生ボタンを押すと、ブラウザ経由でプレイリストを開きます。</p>

<p>切断ボタンは選択しているチャンネルの接続を切り、リストから削除します。</p>

<p>再接続ボタンは選択しているチャンネルのリレーをつなぎなおします。</p>

<p>チャンネル一覧で右クリックするか、上のメニューからチャンネル(C)を選ぶと選択しているチャンネルに対して追加の操作が行なえます。</p>

<p><img src="images/gui_playcontextmenu.png" alt="チャンネル操作" /></p>

<p>再生・切断・再接続メニューはそれぞれ再生・切断・再接続ボタンと同じです。</p>

<p>コンタクトURLを開くメニューはチャンネル情報のコンタクトURLをブラウザで開きます。</p>

<p>ストリームURLをコピーメニューは視聴用のURLをクリップボードにコピーします。</p>

<p>コンタクトURLをコピーメニューはチャンネル情報のコンタクトURLをクリップボードにコピーします。</p>

<p>チャンネル一覧にはリレー可否状況、チャンネル名、ビットレート、視聴/リレー数、チャンネル状態、が表示されます。</p>

<p>リレー可否状況は記号で表されます。自分の思ったのと違う記号が出ている場合は設定などを見直してください。</p>

<table class="table">
  <tbody>
    <tr>
      <td> </td>
      <td>未接続。IDLEやERRORになってるチャンネルでは何も表示されません。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_0.png" alt="◎" /></td>
      <td>リレー可能。緑。問題ない状態です。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_1.png" alt="○" /></td>
      <td>これ以上リレーができない。青。現在リレーをしているがこれ以上のリレーは増やせない状態です。リレーはできてるので問題はありませんが、思ったよりリレー数が少ないのにいっぱいになっていれば設定を見直してください。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_2.png" alt="△" /></td>
      <td>リレーできない。紫。リレーをしていないのにこれ以上のリレーが増やせない状態です。ポートは開いていますがビットレートやリレー数がいっぱいでリレーできない場合にこの状態になります。複数のチャンネルをリレーしている場合は他のチャンネルを閉じるなりしてください。思ったよりリレー数が少ないのに△になっている場合は設定を見直してください。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_3.png" alt="×" /></td>
      <td>ポート未開放。赤。設定したポートに外からアクセスできないためにリレーができない状態です。ポートの設定でWAN側にリレー許可が入っているか確認してください。またルータの設定を確認してポートが開放されているかを確認してください。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_4.png" alt="？" /></td>
      <td>ポート未開放なのにリレーをしている。橙。設定したポートに外からアクセスできないためにリレーができない状態ですが、なぜかリレーをしている状態です。赤の場合と同じく、ポートおよびルータの設定を確認してください。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_6.png" alt="■" /></td>
      <td>(接続一覧のみ)リレーの受信が滞っている状態です。黒。帯域が足りてない可能性があるので、他の通信しているアプリがないか、帯域設定が正しいか確認してください。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_7.png" alt="YP" /></td>
      <td>(接続一覧のみ)接続先がRoot(YP)であることを示します。配信している時にYPに掲載するための接続に対して表示されます。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_8.png" alt="Tr" /></td>
      <td>(接続一覧のみ)接続先がトラッカー(配信元)であることを示します。この記号がついてた場合はリレー直下に接続されています。</td>
    </tr>
    <tr>
      <td><img src="images/relay_icon_5.png" alt="□" /></td>
      <td>(接続一覧のみ)特に表示する状態がないことを示します。正常な状態です。</td>
    </tr>
  </tbody>
</table>

<p>ポート開放が上手くいっていればステータスバーのポート状態表示が開放になるはずです。なっていない場合はファイアウォールでブロックされているかルータの設定などが上手くいってないようなので、設定を確認してください。</p>

<p>接続一覧のタブを見ると選択しているチャンネルに対する各種ネットワーク接続状況の確認ができます。</p>

<p><img src="images/gui_connectionlist.png" alt="接続一覧" /></p>

<p>記号がついている場合、その内容は上の表にある通りです。</p>

<p>記号のあとにはその接続の種類が表示されます。意味は次の表の通りです。</p>

<table class="table">
  <tbody>
    <tr>
      <td>HTTP Source</td>
      <td>HTTPでデータを受信している接続です。配信時のみあります。</td>
    </tr>
    <tr>
      <td>HTTP Direct</td>
      <td>HTTPで視聴している接続です。メディアプレイヤーの接続を表します。</td>
    </tr>
    <tr>
      <td>PCP Source</td>
      <td>リレー受信をしている接続です。</td>
    </tr>
    <tr>
      <td>PCP Relay</td>
      <td>リレー送信をしている接続です。</td>
    </tr>
    <tr>
      <td>PCP COUT</td>
      <td>チャンネル情報をYPに載せる接続です。配信時のみあります。</td>
    </tr>
  </tbody>
</table>

<p>チャンネル情報のタブを見ると選択しているチャンネル情報の確認ができます。</p>

<p><img src="images/gui_channelinfo.png" alt="チャンネル情報" /></p>

<p>視聴しているチャンネルは見るだけですが、自分で配信しているチャンネルの情報は編集ができます。編集した場合は一番下の更新ボタンを押してください。</p>

<h2 id="使い方---html-ui編">使い方 - HTML UI編</h2>
<p>起動後 <a href="http://localhost:7144/html/index.html">http://localhost:7144/html/index.html</a> にアクセスするとHTML UIが表示されます。</p>

<p><img src="images/gui_statusmenu.png" alt="ステータスアイコン・メニュー" /></p>

<p>GUIのファイル(F)メニューやステータスアイコンを右クリックして表示されるメニューから、HTML UIを表示メニューを選択しても表示することができます。</p>

<p><img src="images/htmlui_index.png" alt="HTML UIトップページ" /></p>

<p>アクセスできない場合は7144ポートが開けない可能性があります。他に7144ポートを使用しているアプリケーションがあれば終了させてからPeerCastStation.exeを再起動してください。</p>

<h3 id="設定-1">設定</h3>
<p>一番上のナビゲーションリンクから設定をクリックしましょう。</p>

<p><img src="images/htmlui_settings.png" alt="設定ページ" /></p>

<p>ポート一覧の追加ボタンを押すとポートの設定ができます。
リストに「IPv4 Any:7144」で始まる項目があれば特に設定する必要はありません。</p>

<p>もし7144以外のポートを使用する場合はHTML UIへのアクセスするURLも変わることに気をつけてください。</p>

<p>開放確認ボタンを押すとポートが空けられているか確認できます。
「開放されています」になった場合は問題ありません。
「未開放です」になった場合は使っているマシンに向けてポートが開放されていません。設定の方法はルータの説明を見てください。</p>

<p>あとは最大上り帯域を設定しましょう。
最大上り帯域の合計は自動設定ボタンを押すことで設定できます。しばらく時間がかかるので(長くて30秒程度)押したら気長に待ってください。
計測した上り帯域数の80%の値が自動的に設定されます。</p>

<p>最大上り帯域のチャンネル毎の方は0(=制限無し)のままで問題ありません。一つのチャンネルで帯域が埋まると困るなど判断できる場合に適度に設定してください。他にも最大リレー数・最大視聴数がありますが、これらも通常は0(=制限無し)で問題ありません。</p>

<p>チャンネル自動切断は終了したチャンネルなどを自動的にチャンネル一覧から消す(リレーも切る)機能です。既定では接続していない(視聴もリレーもしていない)状態が30分続くとチャンネルが消えるようになっています。使ってみて好きなように設定してください。</p>

<p>配信を見るだけならここまで設定すれば十分です。設定はすぐ反映されています。</p>

<h3 id="配信を見る-1">配信を見る</h3>
<p>新しく配信を見るのはPeerCastStation単体ではできません。
WebブラウザでYPのページからPlayリンクで再生するか、各種YPブラウザで再生を開始してください。
PeerCastStation内蔵のYPブラウザを使用するには<a href="ypbrowser.html">YPブラウザのヘルプ</a>を見てください。</p>

<p>ナビゲーションリンクでリレーのページに移動するとリレーしているチャンネル一覧を表示できます。</p>

<p><img src="images/htmlui_channellist.png" alt="チャンネル一覧ページ" /></p>

<p>接続しているチャンネルはチャンネル一覧に出ます。</p>

<p>チャンネル名の下に並んでいるボタンで各種情報の表示と操作が行なえます。</p>

<table class="table">
  <tbody>
    <tr>
      <td><img src="images/htmlui_channelbutton0.png" alt="チャンネル情報表示" /></td>
      <td>チャンネル情報の表示・非表示を切り替えます。</td>
    </tr>
    <tr>
      <td><img src="images/htmlui_channelbutton1.png" alt="接続一覧表示" /></td>
      <td>接続一覧の表示・非表示を切り替えます。</td>
    </tr>
    <tr>
      <td><img src="images/htmlui_channelbutton2.png" alt="リレーツリー表示" /></td>
      <td>リレーツリーの表示・非表示を切り替えます。</td>
    </tr>
    <tr>
      <td><img src="images/htmlui_channelbutton3.png" alt="再生" /></td>
      <td>ブラウザ経由でプレイリストを開きます。</td>
    </tr>
    <tr>
      <td><img src="images/htmlui_channelbutton4.png" alt="再接続" /></td>
      <td>チャンネルのリレーをつなぎなおします。</td>
    </tr>
    <tr>
      <td><img src="images/htmlui_channelbutton5.png" alt="切断" /></td>
      <td>チャンネルの接続を切り、リストから削除します。</td>
    </tr>
  </tbody>
</table>

<p>コンタクトURLが設定されているチャンネルはチャンネル名の部分にコンタクトURLへのリンクが張られます。</p>

<p>また、内容の列にあるWMVなどのストリームタイプの部分にはストリームURLへのリンクが張られます。</p>

<p>チャンネル情報のボタンを押すと選択しているチャンネルの情報の確認ができます。</p>

<p><img src="images/htmlui_channelinfo.png" alt="チャンネル情報" /></p>

<p>視聴しているチャンネルは見るだけですが、自分で配信しているチャンネルの情報は編集ボタンで変更することができます。</p>

<h2 id="使い方---その他">使い方 - その他</h2>

<h3 id="自動リレー管理について">自動リレー管理について</h3>
<p>1.4.0から自動リレー管理機能がつきました。自動で行ううえに設定する物もないので、使ってる上で気にすることもないのですが、気になる人のために解説しておきます。</p>

<p>自動リレー管理は以下の条件が全て満たされた時に行われます</p>

<ul>
  <li>新しいリレー要求が来た</li>
  <li>リレー要求されたチャンネルのリレーが既にいっぱいである</li>
  <li>リレー要求されたチャンネルの下位リレーとして再リレー不可のノード(ポート未開放×・帯域不足△)がいる</li>
</ul>

<p>自動リレー管理は以下の動作を行います</p>

<ul>
  <li>リレー要求されたチャンネルの下位リレーとして再リレー不可のノードに他の下位リレーのノード情報を送信する</li>
  <li>リレー要求されたチャンネルの下位リレーとして再リレー不可のノードを切断する</li>
  <li>(切断によってリレーが空けば)新しく要求されたリレーを受け入れる</li>
</ul>

<p>簡単に言うと、新しいリレー要求があったら既につながってる×や△の子リレーを切って新しいリレーを優先して接続します。</p>

<p>切断する下位リレーは自分のすぐ下のノードだけなので、自分のすぐ下に×や△がなければ普通にさらに下位のノードへの接続を促します。</p>

<p>自動リレー管理についてよくある質問</p>

<dl>
  <dt>△(俗に言う紫・帯域が足りないノード)が切られるということは、帯域が足りないチャンネルは見られなくなる？</dt>
  <dd>いいえ。新しいリレー要求が来た場合に優先的に切られるだけで、そのあと再接続ができれば問題なく視聴しつづけられます。
×(俗に言う赤・ポートが開いてないノード)の場合も同じです。</dd>
  <dt>従来のPeerCastはどうなる？</dt>
  <dd>動作はかわりません。紫や赤のノードは優先的に切断されます。</dd>
</dl>


        </div>
      </div>
    </div>
  </body>
</html>
