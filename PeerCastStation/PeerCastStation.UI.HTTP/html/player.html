<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>再生</title>
    <script type="text/javascript" src="/Scripts/es5-shim.min.js"></script>
    <script type="text/javascript" src="/Scripts/es6-shim.min.js"></script>
    <link href="https://vjs.zencdn.net/7.20.2/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.20.2/video.min.js"></script>
    <style>
  #player {
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
  }
    </style>
  </head>
  <body>
    <video id="player" class="video-js" controls preload="auto" width="960" height="540" data-setup='{"liveui": true, "autoplay": true, "userActions": { "click": false } }'>
    </video>
    <script type="text/javascript">
      window.addEventListener('load', function () {
        var params = (new URL(document.location)).searchParams;
        var channelId = params.get('channelId');
        var tracker = params.get('tip');
        var player = videojs('player');
        var lastVolume = parseFloat(window.localStorage.getItem('player.volume'))
        player.volume(isNaN(lastVolume) ? 0.5 : lastVolume)
        player.el().addEventListener('wheel', function (evt) {
          if (evt.deltaY!==0.0) {
            var dy = (evt.deltaY < 0.0 ? 1.0 : -1.0) * 0.10;
            if (dy > 0.0 && player.muted()) {
              player.volume(dy);
              player.muted(false);
            }
            else {
              player.volume(player.volume() + dy);
            }
          }
        });
        player.on('volumechange', function (evt) {
          try {
            window.localStorage.setItem('player.volume', player.volume().toString())
          }
          catch {
          }
        });
        if (channelId) {
          if (tracker) {
            player.src({type: 'video/mpegURL', src: '/hls/' + channelId + '.m3u8?tip=' + tracker});
          }
          else {
            player.src({type: 'video/mpegURL', src: '/hls/' + channelId + '.m3u8'});
          }
        }
      });
    </script>
  </body>
</html>
